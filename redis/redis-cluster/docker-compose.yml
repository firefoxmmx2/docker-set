services:
  redis-node1:
    image: redis:7.2-alpine
    container_name: redis-node1
    restart: unless-stopped
    command: ["redis-server", "/usr/local/etc/redis/redis.conf", "--requirepass", "${REDIS_PASSWORD}", "--masterauth", "${REDIS_PASSWORD}"]
    ports:
      - "7000:6379"        # client port
      - "17000:16379"      # cluster bus
    volumes:
      - ./conf/node1/redis.conf:/usr/local/etc/redis/redis.conf:ro
      - redis-node1-data:/data
    environment:
      - REDIS_PASSWORD=${REDIS_PASSWORD}
    networks:
      - rediscluster

  redis-node2:
    image: redis:7.2-alpine
    container_name: redis-node2
    restart: unless-stopped
    command: ["redis-server", "/usr/local/etc/redis/redis.conf", "--requirepass", "${REDIS_PASSWORD}", "--masterauth", "${REDIS_PASSWORD}"]
    ports:
      - "7001:6379"
      - "17001:16379"
    volumes:
      - ./conf/node2/redis.conf:/usr/local/etc/redis/redis.conf:ro
      - redis-node2-data:/data
    environment:
      - REDIS_PASSWORD=${REDIS_PASSWORD}
    networks:
      - rediscluster

  redis-node3:
    image: redis:7.2-alpine
    container_name: redis-node3
    restart: unless-stopped
    command: ["redis-server", "/usr/local/etc/redis/redis.conf", "--requirepass", "${REDIS_PASSWORD}", "--masterauth", "${REDIS_PASSWORD}"]
    ports:
      - "7002:6379"
      - "17002:16379"
    volumes:
      - ./conf/node3/redis.conf:/usr/local/etc/redis/redis.conf:ro
      - redis-node3-data:/data
    environment:
      - REDIS_PASSWORD=${REDIS_PASSWORD}
    networks:
      - rediscluster
  redis-node4:
    image: redis:7.2-alpine
    container_name: redis-node4
    restart: unless-stopped
    command: ["redis-server", "/usr/local/etc/redis/redis.conf", "--requirepass", "${REDIS_PASSWORD}", "--masterauth", "${REDIS_PASSWORD}"]
    ports:
      - "7003:6379"
      - "17003:16379"
    volumes:
      - ./conf/node4/redis.conf:/usr/local/etc/redis/redis.conf:ro
      - redis-node4-data:/data
    environment:
      - REDIS_PASSWORD=${REDIS_PASSWORD}
    networks:
      - rediscluster
  redis-node5:
    image: redis:7.2-alpine
    container_name: redis-node5
    restart: unless-stopped
    command: ["redis-server", "/usr/local/etc/redis/redis.conf", "--requirepass", "${REDIS_PASSWORD}", "--masterauth", "${REDIS_PASSWORD}"]
    ports:
      - "7004:6379"
      - "17004:16379"
    volumes:
      - ./conf/node5/redis.conf:/usr/local/etc/redis/redis.conf:ro
      - redis-node5-data:/data
    environment:
      - REDIS_PASSWORD=${REDIS_PASSWORD}
    networks:
      - rediscluster

  redis-node6:
    image: redis:7.2-alpine
    container_name: redis-node6
    restart: unless-stopped
    command: ["redis-server", "/usr/local/etc/redis/redis.conf", "--requirepass", "${REDIS_PASSWORD}", "--masterauth", "${REDIS_PASSWORD}"]
    ports:
      - "7005:6379"
      - "17005:16379"
    volumes:
      - ./conf/node6/redis.conf:/usr/local/etc/redis/redis.conf:ro
      - redis-node6-data:/data
    environment:
      - REDIS_PASSWORD=${REDIS_PASSWORD}
    networks:
      - rediscluster

networks:
  rediscluster:
    driver: bridge

volumes:
  redis-node1-data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ./redis-node1-data
  redis-node2-data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ./redis-node2-data
  redis-node3-data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ./redis-node3-data
  redis-node4-data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ./redis-node4-data
  redis-node5-data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ./redis-node5-data
  redis-node6-data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ./redis-node6-data
