name: DiskUsageWithWechat
# rule
type: metric_aggregation
index: metricbeat-*
use_strftime_index: true

# Exemple query
include: ["@timestamp","agent.hostname","system.filesystem.mount_point"]

query_timezone: Asia/Chongqing
filter:
- query:
    query_string:
      query: "system.filesystem.used.pct: (>0.8)"

metric_agg_type: max
metric_agg_key: system.filesystem.used.pct
max_threshold: 0.8
query_key: 
  - system.filesystem.mount_point
  - agent.hostname

realert:
  minutes: 10


    #alert
alert: slack
slack_username: "ElastAlert-DiskMonitor"
slack_icon_emoji: ":hard_drive:"
slack_text: |
  :exclamation: 磁盘使用告警：
  *检测时间*: {{ _data['@timestamp'] }}
  *主机名称*: `{{ _data['agent.hostname'] }}`
  *挂载目录*: `{{ _data['system.filesystem.mount_point'] }}`
  *使用比例*: {{ "%.2f"|format(_data['system.filesystem.used.pct']*100) }}%
